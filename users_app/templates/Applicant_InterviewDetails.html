{% extends "Applicant_Inheritance.html" %}
{% load static %}

{% block title %}Interview Details{% endblock %}

{% block page_id %}data-page-id="interview-details"{% endblock %}

{% block content %}
<div class="main-content"
     data-location-name="{{ interview_details.location|default:'' }}">
    <!-- Title -->
    <div class="header-text">Interview Details</div>

    <div class="info-section">
        {% if show_not_qualified_message %}
        <div class="info-column">
            <div class="info-text">Status</div>
            <div class="info-container">You are not yet qualified for an interview.</div>
        </div>
        {% elif show_no_schedule_message %}
        <div class="info-column">
            <div class="info-text">Status</div>
            <div class="info-container">No interview schedule yet.</div>
        </div>
        {% elif interview_details %}
        <div class="info-column">
            <div class="info-text">Name of Interviewer</div>
            <div class="info-container">{{ interview_details.interviewer_name }}</div>
            <div class="info-text">Schedule Date</div>
            <div class="info-container">{{ interview_details.schedule_date }}</div>
            <div class="info-text">Interview Location</div>
            <div class="info-container">{{ interview_details.location }}</div>
            <div class="message-text">Interviewer Message:</div>
            <div class="message-container">
                {{ interview_details.interview_message }}
            </div>
        </div>
        <div class="admin-map-container"></div>
        {% endif %}
    </div>

    <!-- Buttons -->
    <div class="buttons-container">
        <button class="sfbutton" onclick="location.href='{% url 'generate_pdf' applicant_status_id=interview_details.applicant_job_id %}'">Download PDF</button>
        <br>
        <button id="printButton" class="button">Print</button>
    </div>
</div>
{% endblock %}

{% block script %}
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const pageId = document.body.dataset.pageId;
        if (pageId === 'interview-details') {
            const mapContainer = document.getElementById('.admin-map-container');
            const locationName = document.querySelector('.info-section .info-container:nth-child(7)')?.innerText.trim();

            iif (locationName && mapContainer) {
                fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(locationName)}&format=json&addressdetails=1`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.length > 0) {
                            const { lat, lon } = data[0];
                            const map = L.map(mapContainer, {
                                zoomControl: true,
                                scrollWheelZoom: true,
                                dragging: true
                            }).setView([lat, lon], 13);

                            // Add OpenStreetMap tiles
                            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                maxZoom: 19
                            }).addTo(map);

                            // Add a marker at the location
                            L.marker([lat, lon]).addTo(map)
                                .bindPopup(locationName)
                                .openPopup();
                        } else {
                            console.warn('Location not found for geocoding.');
                            mapContainer.innerHTML = `<p>Map data not available for this location.</p>`;
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching geocoding data:', error);
                        mapContainer.innerHTML = `<p>Error loading map data.</p>`;
                    });
            } else {
                console.warn('Location data is missing or invalid.');
                if (mapContainer) {
                    mapContainer.innerHTML = `<p>Map data not available.</p>`;
                }
            }
        }
    });
</script>
{% endblock %}
